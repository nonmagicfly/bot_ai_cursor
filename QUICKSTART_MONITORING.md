# üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

–ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É —Å–∏—Å—Ç–µ–º—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ Prometheus + Grafana –¥–ª—è Telegram –±–æ—Ç–∞.

## –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### 1.1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ —Ñ–∞–π–ª–∞ `.env`

```bash
# Windows PowerShell
if (Test-Path .env) { Write-Host "–§–∞–π–ª .env —Å—É—â–µ—Å—Ç–≤—É–µ—Ç" } else { Write-Host "–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env" }

# Linux/Mac
ls -la .env
```

–ï—Å–ª–∏ —Ñ–∞–π–ª–∞ –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ:

```bash
# Windows PowerShell
Copy-Item env.example .env

# Linux/Mac
cp env.example .env
```

### 1.2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ/–ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ
BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–∑–¥–µ—Å—å

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: admin)
GRAFANA_PASSWORD=–≤–∞—à_–ø–∞—Ä–æ–ª—å_–¥–ª—è_grafana

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: ./data/gym.db)
DATABASE=./data/gym.db
```

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `–≤–∞—à_—Ç–æ–∫–µ–Ω_–±–æ—Ç–∞_–∑–¥–µ—Å—å` –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω –æ—Ç @BotFather!

## –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–æ–≤

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã –Ω–∞ –º–µ—Å—Ç–µ:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
ls -la bot.py metrics.py metrics_server.py prometheus.yml docker-compose.yml

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Grafana
ls -la grafana/provisioning/datasources/prometheus.yml
ls -la grafana/provisioning/dashboards/dashboards.yml
```

## –®–∞–≥ 3: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–¥–µ–ª–∞–Ω–æ)

```bash
python db_init.py
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç —Ç–∞–±–ª–∏—Ü—ã `users` –∏ `operations` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

## –®–∞–≥ 4: –ó–∞–ø—É—Å–∫ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

### –í–∞—Ä–∏–∞–Ω—Ç A: –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ —á–µ—Ä–µ–∑ Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ (–±–æ—Ç + Prometheus + Grafana)
docker-compose up -d

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ó–∞–ø—É—Å–∫ —Ç–æ–ª—å–∫–æ –±–æ—Ç–∞ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã)
pip install -r requirements.txt

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞
python bot.py
```

–ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç HTTP —Å–µ—Ä–≤–µ—Ä –¥–ª—è –º–µ—Ç—Ä–∏–∫ –Ω–∞ –ø–æ—Ä—Ç—É 8000.

## –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 5.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫ –±–æ—Ç–∞

–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ —á–µ—Ä–µ–∑ curl:

```bash
# Health check
curl http://localhost:8000/health

# –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
curl http://localhost:8000/metrics
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å—Å—è –æ—Ç–≤–µ—Ç `OK` –¥–ª—è health check –∏ —Å–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫ –¥–ª—è `/metrics`.

### 5.2. –ü—Ä–æ–≤–µ—Ä–∫–∞ Prometheus

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:9090**
2. –í –ø–æ–ª–µ –∑–∞–ø—Ä–æ—Å–∞ –≤–≤–µ–¥–∏—Ç–µ: `bot_health`
3. –ù–∞–∂–º–∏—Ç–µ "Execute"
4. –î–æ–ª–∂–Ω–æ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ `1` (–±–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç)

### 5.3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ: **http://localhost:3000**
2. –í–æ–π–¥–∏—Ç–µ —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
   - **–õ–æ–≥–∏–Ω:** `admin`
   - **–ü–∞—Ä–æ–ª—å:** –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ `.env` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é: `admin`)
3. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Dashboards** ‚Üí **Browse**
4. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –¥–∞—à–±–æ—Ä–¥ "Telegram Bot Monitoring"

## –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Grafana (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### 6.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Prometheus

1. –í Grafana –ø–µ—Ä–µ–π–¥–∏—Ç–µ: **Configuration** ‚Üí **Data Sources**
2. –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞—Å—Ç—Ä–æ–µ–Ω **Prometheus** —Å URL: `http://prometheus:9090`
3. –°—Ç–∞—Ç—É—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å **Green** (—Ä–∞–±–æ—Ç–∞–µ—Ç)

### 6.2. –ò–º–ø–æ—Ä—Ç –¥–∞—à–±–æ—Ä–¥–∞ (–µ—Å–ª–∏ –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: **Dashboards** ‚Üí **Import**
2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª: `grafana/dashboards/telegram-bot-dashboard.json`
3. –í—ã–±–µ—Ä–∏—Ç–µ datasource: **Prometheus**
4. –ù–∞–∂–º–∏—Ç–µ **Import**

## –®–∞–≥ 7: –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose logs -f

# –¢–æ–ª—å–∫–æ –±–æ—Ç
docker-compose logs -f telegram-bot

# –¢–æ–ª—å–∫–æ Prometheus
docker-compose logs -f prometheus

# –¢–æ–ª—å–∫–æ Grafana
docker-compose logs -f grafana
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ
docker-compose down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å —É–¥–∞–ª–µ–Ω–∏–µ–º volumes (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)
docker-compose down -v
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö
docker-compose restart

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose restart telegram-bot
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑ –±–æ—Ç–∞
docker-compose build telegram-bot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å –Ω–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º
docker-compose up -d telegram-bot
```

## –®–∞–≥ 8: –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Ç—Ä–∏–∫

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –º–µ—Ç—Ä–∏–∫–∏:

### –í Prometheus (http://localhost:9090)

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–ø—Ä–æ—Å—ã:

```promql
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
bot_users_total

# –ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–µ–≥–æ–¥–Ω—è
bot_users_active_today

# –û–ø–µ—Ä–∞—Ü–∏–∏ –∑–∞ —Å–µ–≥–æ–¥–Ω—è
bot_operations_today

# –ó–∞–≥—Ä—É–∑–∫–∞ CPU
bot_system_cpu_percent

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
bot_system_memory_percent

# –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞
bot_uptime_seconds
```

### –í Grafana

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–∞—à–±–æ—Ä–¥ "Telegram Bot Monitoring"
2. –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
   - –°—Ç–∞—Ç—É—Å –±–æ—Ç–∞ (Health)
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –û–ø–µ—Ä–∞—Ü–∏–∏
   - –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–æ—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs telegram-bot

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ BOT_TOKEN —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
docker-compose exec telegram-bot env | grep BOT_TOKEN
```

### –ü—Ä–æ–±–ª–µ–º–∞: Prometheus –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±–æ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω:
   ```bash
   curl http://localhost:8000/metrics
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é Prometheus:
   ```bash
   docker-compose exec prometheus cat /etc/prometheus/prometheus.yml
   ```

3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Prometheus:
   ```bash
   docker-compose logs prometheus
   ```

### –ü—Ä–æ–±–ª–µ–º–∞: Grafana –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Prometheus

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏:
   ```bash
   docker-compose ps
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ datasource –≤ Grafana:
   - URL –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å: `http://prometheus:9090`
   - Access: **Server (default)**

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Ä—Ç —É–∂–µ –∑–∞–Ω—è—Ç

–ï—Å–ª–∏ –ø–æ—Ä—Ç—ã 8000, 9090 –∏–ª–∏ 3000 –∑–∞–Ω—è—Ç—ã:

1. –ò–∑–º–µ–Ω–∏—Ç–µ –ø–æ—Ä—Ç—ã –≤ `docker-compose.yml`:
   ```yaml
   ports:
     - "8001:8000"  # –í–º–µ—Å—Ç–æ 8000:8000
     - "9091:9090"  # –í–º–µ—Å—Ç–æ 9090:9090
     - "3001:3000"  # –í–º–µ—Å—Ç–æ 3000:3000
   ```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ:
   ```bash
   docker-compose down
   docker-compose up -d
   ```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:

1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫
2. ‚úÖ –ù–∞–±–ª—é–¥–∞–π—Ç–µ –º–µ—Ç—Ä–∏–∫–∏ –≤ Grafana
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –≤ Prometheus (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
4. ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- üìñ [MONITORING.md](MONITORING.md) - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥—É
- üìñ [README.md](README.md) - –û–±—â–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- üìñ [DEPLOYMENT.md](DEPLOYMENT.md) - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏—é


